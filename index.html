<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>泰時刻 THAISKR - 愛泰人士的文化基地</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts - Noto Sans TC (近似源柔黑體) & Oswald (近似 Agrandir Narrow) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- 自訂樣式 -->
    <style>
        /* 應用字體與基本樣式 */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            color: #592E3D; /* text-dark-brown */
            background-color: #FFFCF5; /* A very light beige background */
        }

        /* 英文標題使用 Oswald 字體 */
        h1, h2, h3, h4, h5, h6, .font-eng {
            font-family: 'Oswald', 'Noto Sans TC', sans-serif;
        }
        
        /* 頁面切換效果 */
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        
        /* 導覽列固定與陰影 */
        header {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: rgba(255, 252, 245, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* AI 介紹內容的顯示/隱藏動畫 */
        .ai-notes-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out;
        }
        .ai-notes-content.show {
            max-height: 1000px; /* A large enough value */
            margin-top: 1rem;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header / Navigation Bar -->
    <header class="w-full shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="font-eng text-2xl font-bold tracking-wider nav-link" data-target="home">泰時刻 THAISKR</a>
            <nav class="hidden md:flex space-x-8 items-center">
                <a href="#services" class="hover:text-[#F0725C] transition duration-300">我的服務</a>
                <a href="#" class="hover:text-[#F0725C] transition duration-300 nav-link" data-target="all-products">泰時刻的書櫃子賣場</a>
                <a href="#" class="hover:text-[#F0725C] transition duration-300 nav-link" data-target="learning-tools">學習工具</a>
                <a href="#" class="hover:text-[#F0725C] transition duration-300 nav-link" data-target="courses">泰語課程</a>
                <a href="#about" class="hover:text-[#F0725C] transition duration-300">關於我</a>
                <a href="#contact" class="hover:text-[#F0725C] transition duration-300">聯絡我</a>
            </nav>
            <button id="mobile-menu-button" class="md:hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-4 6h4" />
                </svg>
            </button>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#services" class="block py-2 hover:text-[#F0725C]">我的服務</a>
            <a href="#" class="block py-2 hover:text-[#F0725C] nav-link" data-target="all-products">泰時刻的書櫃子賣場</a>
            <a href="#" class="block py-2 hover:text-[#F0725C] nav-link" data-target="learning-tools">學習工具</a>
            <a href="#" class="block py-2 hover:text-[#F0725C] nav-link" data-target="courses">泰語課程</a>
            <a href="#about" class="block py-2 hover:text-[#F0725C]">關於我</a>
            <a href="#contact" class="block py-2 hover:text-[#F0725C]">聯絡我</a>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="main-content">
        
        <!-- ======================= -->
        <!--      首頁內容 (Home)     -->
        <!-- ======================= -->
        <div id="home" class="page active">
            <!-- Hero Section -->
            <section class="h-screen min-h-[600px] bg-cover bg-center flex items-center" style="background-image: url('https://images.unsplash.com/photo-1528181304800-259b08848526?q=80&w=2070&auto=format&fit=crop');">
                <div class="bg-black bg-opacity-40 w-full h-full flex items-center justify-center">
                    <div class="text-center text-white p-8">
                        <h1 class="font-eng text-5xl md:text-7xl font-bold tracking-widest">泰時刻 THAISKR</h1>
                        <p class="mt-4 text-xl md:text-2xl">愛泰人士的文化基地</p>
                        <a href="#services" class="mt-8 inline-block bg-[#F0725C] hover:bg-[#E0644C] text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors">探索我的服務</a>
                    </div>
                </div>
            </section>

            <!-- About Me Section -->
            <section id="about" class="py-20 bg-white">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl font-bold mb-12">關於我</h2>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-12">
                        <img src="https://placehold.co/300x300/F2834D/592E3D?text=Kru+Jane" alt="Kru Jane 的照片" class="w-48 h-48 md:w-60 md:h-60 rounded-full object-cover shadow-lg">
                        <p class="max-w-2xl text-lg leading-relaxed text-left">
                            嗨！我是 Kru Jane。創立「泰時刻」是希望將我對泰國文化的熱愛，分享給在台灣的每一個你。<br><br>
                            這裡不只是一個商店，更是一個有溫度的文化交流空間，希望能為你的生活，帶來一絲來自泰國的陽光。
                        </p>
                    </div>
                </div>
            </section>

            <!-- Services Section -->
            <section id="services" class="py-20 bg-[#FAC191]">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl font-bold text-center mb-12">我的三大核心服務</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <!-- Service 1: Bookstore -->
                        <div class="bg-white p-8 rounded-lg shadow-lg text-center flex flex-col">
                            <h3 class="text-2xl font-bold mb-4">泰時刻的書櫃子</h3>
                            <p class="mb-6 flex-grow">為您精心挑選泰國直送的書籍、充滿設計感的文創小物與特色服飾。</p>
                            <a href="#" data-target="all-products" class="nav-link inline-block bg-[#F0725C] hover:bg-[#E0644C] text-white font-bold py-2 px-6 rounded-lg transition-colors">前往商品詳細介紹</a>
                        </div>
                        <!-- Service 2: Fun Thai Learning -->
                        <div class="bg-white p-8 rounded-lg shadow-lg text-center flex flex-col">
                            <h3 class="text-2xl font-bold mb-4">有趣點子學泰語</h3>
                            <p class="mb-6 flex-grow">這是一個互動學習專區，除了分享學習資源，我也會將自己實作的網頁小工具放在這裡！</p>
                             <a href="#" class="inline-block bg-[#43857A] hover:bg-[#3A756A] text-white font-bold py-2 px-6 rounded-lg transition-colors nav-link" data-target="learning-tools">泰語學習小工具</a>
                        </div>
                        <!-- Service 3: 1-on-1 Courses -->
                        <div class="bg-white p-8 rounded-lg shadow-lg text-center flex flex-col">
                            <h3 class="text-2xl font-bold mb-4">泰語一對一課程</h3>
                            <p class="mb-6 flex-grow">由創辦人 Kru Jane 親自授課，課程涵蓋【初級會話】、【初中級會話】與【泰文字母&規則】。</p>
                            <a href="#" class="inline-block bg-[#F0725C] hover:bg-[#E0644C] text-white font-bold py-2 px-6 rounded-lg transition-colors nav-link" data-target="courses">查看課程詳情</a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Featured Products Section -->
            <section id="featured-products" class="py-20 bg-white">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl font-bold text-center mb-12">熱銷推薦</h2>
                    <div id="featured-products-container" class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Product cards will be inserted here by JavaScript -->
                    </div>
                     <div class="text-center mt-12">
                        <a href="#" class="inline-block bg-[#43857A] hover:bg-[#3A756A] text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors nav-link" data-target="all-products">瀏覽賣場所有商品</a>
                    </div>
                </div>
            </section>
            
            <!-- Contact Section -->
            <section id="contact" class="py-20 bg-[#898A4D]">
                <div class="container mx-auto px-6 text-center text-white">
                    <h2 class="text-4xl font-bold mb-6">追蹤我，發現更多泰國大小事！</h2>
                    <a href="https://www.instagram.com/thaiskrthai/" target="_blank" class="inline-block bg-white p-4 rounded-full shadow-lg transition transform hover:scale-110">
                        <svg class="w-10 h-10 text-[#592E3D]" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919 4.919 1.266-.058 1.644-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.441 1.441 1.441 1.441-.645 1.441-1.441-.645-1.44-1.441-1.44z"/>
                        </svg>
                    </a>
                </div>
            </section>
        </div>

        <!-- =========================== -->
        <!--      所有商品頁面 (All Products)     -->
        <!-- =========================== -->
        <div id="all-products" class="page p-8 md:p-16">
            <h1 class="text-4xl font-bold text-center mb-4">泰時刻的書櫃子賣場</h1>
            <p class="text-center text-lg mb-12">所有商品皆由 7-11 賣貨便系統處理訂單與寄送。<br>若賣場無貨，請私訊@thaiskrthai，將於下個月訂購</p>
            <!-- Filter Section -->
            <div id="filter-container" class="mb-8 flex flex-wrap justify-center gap-2 md:gap-4">
                <!-- Filter buttons will be inserted here -->
            </div>
            <div id="all-products-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8">
                <!-- All product cards will be inserted here by JavaScript -->
            </div>
        </div>
        
        <!-- =========================== -->
        <!--      學習工具頁面 (Learning Tools)     -->
        <!-- =========================== -->
        <div id="learning-tools" class="page p-8 md:p-16">
            <h1 class="text-4xl font-bold text-center mb-4">泰語學習小工具</h1>
            <p class="text-center text-lg">這是我實作的一些網頁應用程式作品集。</p>
            <p class="text-center font-bold">
                <a target="_blank" href="https://forms.gle/f1zwAMHRy4NQYzS66" 
                    class="text-orange-600 hover:text-orange-800 hover:underline">
                    🚀 講座錄影回放！從0到1透過AI工具打造泰語個人化應用程式
                </a>
            </p>
            <p class="text-center text-sm mb-12">
                想透過AI工具加速泰語學習嗎? 實作出適合你的輔助工具! 
                <a target="_blank" href="https://forms.gle/f1zwAMHRy4NQYzS66" 
                    class="text-teal-600 font-semibold hover:text-teal-800 hover:underline">
                    點此報名！
                </a>
            </p>
            <div id="learning-tools-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Learning tool cards will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- =========================== -->
        <!--      泰語課程頁面 (Courses)     -->
        <!-- =========================== -->
        <div id="courses" class="page p-8 md:p-16 bg-white">
            <div class="container mx-auto">
                <h1 class="text-4xl font-bold text-center mb-12">泰語一對一課程</h1>
                <div class="bg-white rounded-lg shadow-xl p-8 md:p-12">
                     <!-- Teacher Intro -->
                    <div class="flex flex-col md:flex-row items-center gap-8 mb-12">
                        <img src="https://placehold.co/400x400/F0725C/FFFFFF?text=Kru+Jane" alt="Kru Jane 的照片" class="w-40 h-40 rounded-full object-cover">
                        <div>
                            <h2 class="text-3xl font-bold mb-2">教師簡介：Kru Jane</h2>
                            <p class="text-lg leading-relaxed">我的教學理念是營造一個輕鬆、無壓力的學習氛圍，讓學生敢於開口、樂於練習。我會結合大量生活化的情境與有趣的文化分享，讓學泰語不只是背單字，而是一場有趣的文化探索之旅。</p>
                        </div>
                    </div>
                    
                    <!-- Course Offerings -->
                    <h2 class="text-3xl font-bold text-center mb-8">課程方案</h2>
                    <div class="space-y-8">
                        <!-- Course 1 -->
                        <div class="border-l-4 border-[#F0725C] bg-[#FFF7F5] p-6 rounded-r-lg">
                            <h3 class="text-2xl font-bold mb-2">【初級會話-講義使用泰文字搭配英文拼音】</h3>
                            <p class="text-md">20單元，從旅遊角度出發，大量口說練習，讓你快速上手基本句型，適合零基礎學員。</p>
                        </div>
                        <!-- Course 2 -->
                        <div class="border-l-4 border-[#F2834D] bg-[#FFF7F5] p-6 rounded-r-lg">
                            <h3 class="text-2xl font-bold mb-2">【初中級會話-講義使用泰文字搭配英文拼音】</h3>
                            <p class="text-md">20單元，需完成初級課程。強化句構句型，融入泰劇、流行梗等多元內容，讓會話更道地。</p>
                        </div>
                        <!-- Course 3 -->
                        <div class="border-l-4 border-[#43857A] bg-[#FFF7F5] p-6 rounded-r-lg">
                            <h3 class="text-2xl font-bold mb-2">【泰文字母&規則】</h3>
                            <p class="text-md">帶你識讀泰文字母、搞懂音調規則，並傳授手機鍵盤使用技巧，讓你看到泰文不再驚慌！</p>
                        </div>
                    </div>

                    <!-- Call to Action -->
                    <div class="text-center mt-16">
                        <h2 class="text-2xl font-bold mb-4">有興趣學習嗎？</h2>
                        <div class="flex flex-col md:flex-row justify-center items-center gap-4">
                            <a href="https://tw.amazingtalker.com/teachers-and-tutors/thaiskr-thai?page=1&from_tutors_page&language=thai" target="_blank" class="bg-[#F0725C] hover:bg-[#E0644C] text-white font-bold py-3 px-8 rounded-lg text-lg w-full md:w-auto transition-colors">前往 AmazingTalker 預約課程</a>
                            <a href="https://www.instagram.com/thaiskrthai/" target="_blank" class="bg-[#43857A] hover:bg-[#3A756A] text-white font-bold py-3 px-8 rounded-lg text-lg w-full md:w-auto transition-colors">透過 Instagram 私訊諮詢</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
    <!-- Image Modal -->
    <div id="image-modal" class="fixed inset-0 bg-black bg-opacity-75 z-[100] hidden items-center justify-center p-4">
        <div class="relative max-w-4xl max-h-[90vh] bg-white rounded-lg shadow-lg">
            <img id="modal-image" src="" alt="Enlarged product image" class="object-contain max-w-full max-h-[90vh]">
            <button id="close-modal" class="absolute -top-4 -right-4 bg-white rounded-full p-2 text-gray-800 hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>
    
    <footer class="bg-[#592E3D] text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>© 2025 泰時刻 THAISKR. All Rights Reserved. 聯絡信箱: thaiskr555@gmail.com</p>
        </div>
    </footer>


    <script type="module">
        // ===========================
        //      學習工具資料庫
        // ===========================
        import { learningTools } from './data/ai-learning-tools.js';
        // ===========================
        //      商品資料庫 (Product Data)
        // ===========================
        // **警告：此處資料已完全根據 supabase_products_final_v2.csv 檔案重新生成**
        import { products } from './data/products.js';
        // ===========================
        //      核心 JavaScript 邏輯
        // ===========================
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- Google Drive 圖片連結轉換函式 ---
            function convertGoogleDriveUrl(url) {
                if (typeof url !== 'string' || !url.includes('drive.google.com')) {
                    // For invalid or non-Google Drive URLs, return a placeholder
                    return 'https://placehold.co/600x600/FAC191/592E3D?text=Image+Not+Found';
                }
                const regex = /drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/;
                const match = url.match(regex);
                if (match && match[1]) {
                    const fileId = match[1];
                    // Use the more reliable lh3.googleusercontent.com domain for direct image access
                    return `https://lh3.googleusercontent.com/d/${fileId}`;
                }
                // If regex doesn't match (e.g., folder link), return a placeholder
                return 'https://placehold.co/600x600/FAC191/592E3D?text=Invalid+Link';
            }
            
            const mainContent = document.getElementById('main-content');
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('.nav-link');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const closeModalButton = document.getElementById('close-modal');


            // --- 產品渲染邏輯 (全新排版) ---
            function renderProducts(filter = 'all') {
                const container = document.getElementById('all-products-container');
                const featuredContainer = document.getElementById('featured-products-container');
                if (!container) return;
                
                let filteredProducts = products;
                if (filter === 'bestseller') {
                    filteredProducts = products.filter(p => p.is_bestseller);
                } else if (filter !== 'all') {
                    filteredProducts = products.filter(p => p.book_type === filter);
                }

                container.innerHTML = ''; // 清空容器

                filteredProducts.forEach(product => {
                    container.innerHTML += createProductCard(product);
                });
                
                // Also update featured products if on home page
                if (featuredContainer) {
                    const featured = products.filter(p => p.is_bestseller).slice(0, 4);
                    featuredContainer.innerHTML = '';
                    featured.forEach(product => {
                         featuredContainer.innerHTML += createProductCard(product);
                    });
                }
            }
            
            function createProductCard(product) {
                const priceToShow = product.instock_price > 0 ? product.instock_price : product.price;
                const priceHtml = priceToShow > 0 ? `NT$ ${Math.round(priceToShow)}` : '價格洽詢';
                
                const bestsellerBadge = product.is_bestseller ? 
                    `<div class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-md">★ 熱銷</div>` : '';
                
                const imageUrl = convertGoogleDriveUrl(product.image_url_cover);
                
                // 產生規格標籤
                let tagsHtml = '';
                if (product.specification) {
                    const specs = product.specification.split('/');
                    specs.forEach(spec => {
                        if(spec.trim()){
                           tagsHtml += `<div class="bg-gray-200 text-gray-700 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">${spec.trim()}</div>`;
                        }
                    });
                }
                
                // AI 介紹按鈕
                let aiButtonHtml = '';
                 if (product.ai_notes && product.ai_notes.trim().length > 10) {
                    aiButtonHtml = `<button class="text-xs font-semibold text-purple-600 hover:text-purple-800" onclick="toggleAiNotes(event, '${product.handle}')">◎ AI介紹(僅供參考)</button>`;
                }

                // 縮圖庫
                let thumbnailHtml = '';
                const imageUrl1 = product.image_url_1 ? convertGoogleDriveUrl(product.image_url_1) : '';
                const imageUrl2 = product.image_url_2 ? convertGoogleDriveUrl(product.image_url_2) : '';

                if(imageUrl1 && imageUrl1.startsWith('https')) {
                    thumbnailHtml += `<img src="${imageUrl1}" class="w-10 h-10 rounded-md object-cover border-2 border-gray-200 cursor-pointer" onclick="openModal(event, '${imageUrl1}')" loading="lazy">`;
                }
                 if(imageUrl2 && imageUrl2.startsWith('https')) {
                    thumbnailHtml += `<img src="${imageUrl2}" class="w-10 h-10 rounded-md object-cover border-2 border-gray-200 cursor-pointer" onclick="openModal(event, '${imageUrl2}')" loading="lazy">`;
                }

                return `
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col transition-shadow duration-300 hover:shadow-2xl">
                        <div class="relative">
                            <div class="aspect-square w-full overflow-hidden cursor-pointer" onclick="openModal(event, '${imageUrl}')">
                                <img src="${imageUrl}" alt="${product.name}" class="w-full h-full object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x600/FAC191/592E3D?text=Image+Error';">
                            </div>
                            ${bestsellerBadge}
                        </div>
                        <div class="p-5 flex flex-col flex-grow">
                            <p class="text-sm font-semibold" style="color: #F2834D;">${product.book_type || '商品'}</p>
                            <div class="relative group">
                                <h3 class="text-xl font-bold mt-1 truncate">${product.name}</h3>
                                <div class="absolute bottom-full mb-2 w-max max-w-xs bg-[#592E3D] text-white text-sm rounded-md shadow-lg p-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                    ${product.name.replace(/\n/g, '<br>')}
                                </div>
                            </div>
                            <p class="text-2xl font-bold mt-2" style="color: #F0725C;">${priceHtml}</p>
                            <p class="text-sm text-gray-500 mt-2 flex-grow min-h-[40px]">${product.description || ''}</p>
                            <div class="mt-4 flex flex-wrap items-center gap-2">
                                ${tagsHtml}
                                ${aiButtonHtml}
                            </div>
                             <div class="ai-notes-content" id="ai-notes-${product.handle}">
                                <p class="text-xs text-gray-600 whitespace-pre-line">${product.ai_notes || ''}</p>
                            </div>
                            <div class="mt-auto pt-4 flex items-center gap-2">
                                ${thumbnailHtml}
                            </div>
                        </div>
                        <div class="p-4 bg-gray-50 mt-auto">
                            <a href="https://myship.7-11.com.tw/general/detail/GM2409123235798" target="_blank" class="block text-center w-full bg-[#F0725C] hover:bg-[#E0644C] text-white font-bold py-3 px-4 rounded-lg transition-colors">
                                前往賣貨便下訂
                            </a>
                        </div>
                    </div>
                `;
            }
            
            // --- AI 介紹切換 ---
            window.toggleAiNotes = function(event, handle) {
                event.stopPropagation();
                const content = document.getElementById(`ai-notes-${handle}`);
                content.classList.toggle('show');
            }
            
            // --- 圖片 Modal ---
            window.openModal = function(event, imageUrl) {
                event.stopPropagation();
                modalImage.src = imageUrl;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function closeModal() {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                modalImage.src = '';
            }

            closeModalButton.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });


            // --- 頁面切換邏輯 ---
            function switchPage(targetId) {
                if (targetId === 'home') {
                    document.getElementById('home').classList.add('active');
                    document.getElementById('all-products').classList.remove('active');
                    document.getElementById('courses').classList.remove('active');
                    document.getElementById('learning-tools').classList.remove('active');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    document.getElementById('home').classList.remove('active');
                    pages.forEach(page => {
                        page.classList.toggle('active', page.id === targetId);
                    });
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
                mobileMenu.classList.add('hidden');
            }
            
            // --- 事件監聽 ---
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.dataset.target;
                    switchPage(targetId);
                });
            });

            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    if (href.length > 1 && document.querySelector(href)) {
                        e.preventDefault();
                        document.querySelector(href).scrollIntoView({ behavior: 'smooth' });
                        if (!mobileMenu.classList.contains('hidden')) {
                             mobileMenu.classList.add('hidden');
                        }
                    }
                });
            });
            
            // --- 篩選按鈕邏輯 ---
            function setupFilters() {
                const filterContainer = document.getElementById('filter-container');
                const categories = ['all', 'bestseller', ...new Set(products.map(p => p.book_type).filter(Boolean))];
                
                filterContainer.innerHTML = categories.map(cat => {
                    let text, styleClass;
                    if(cat === 'all') {
                        text = '全部商品';
                        styleClass = 'bg-[#F0725C] text-white border-transparent';
                    } else if (cat === 'bestseller') {
                        text = '★ 熱銷推薦';
                        styleClass = 'bg-white text-[#F0725C] border-[#F0725C]';
                    } else {
                        text = cat;
                        styleClass = 'bg-white text-gray-700 border-gray-300';
                    }
                    return `<button class="filter-btn px-4 py-2 rounded-full text-sm font-semibold border transition-colors duration-300 ${styleClass}" data-filter="${cat}">${text}</button>`;
                }).join('');

                filterContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('filter-btn')) {
                        // Update active styles
                        filterContainer.querySelectorAll('.filter-btn').forEach(btn => {
                            btn.classList.remove('bg-[#F0725C]', 'text-white', 'border-transparent');
                            if(btn.dataset.filter === 'bestseller') {
                                btn.classList.add('bg-white', 'text-[#F0725C]', 'border-[#F0725C]');
                            } else {
                                btn.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                            }
                        });
                        e.target.classList.add('bg-[#F0725C]', 'text-white', 'border-transparent');
                        e.target.classList.remove('bg-white', 'text-gray-700', 'border-gray-300', 'text-[#F0725C]', 'border-[#F0725C]');

                        renderProducts(e.target.dataset.filter);
                    }
                });
            }
            
            // --- 學習工具渲染 ---
            function renderLearningTools() {
                const container = document.getElementById('learning-tools-container');
                if(!container) return;
                container.innerHTML = learningTools.map(tool => `
                    <a href="${tool.link}" target="_blank" class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col transition-shadow duration-300 hover:shadow-2xl group">
                        <div class="aspect-video w-full overflow-hidden">
                            <img src="${tool.imageUrl}" alt="${tool.name}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                        </div>
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-center">${tool.name}</h3>
                        </div>
                    </a>
                `).join('');
            }


            // --- 初始渲染 ---
            setupFilters();
            renderProducts('all');
            renderLearningTools();
        });
    </script>
</body>
</html>
